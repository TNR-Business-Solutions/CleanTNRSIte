class TNRFormIntegration{constructor(){this.initializeFormHandlers()}initializeFormHandlers(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.setupFormHandlers()):this.setupFormHandlers()}setupFormHandlers(){const e=document.getElementById("contact-form");e&&e.addEventListener("submit",e=>this.handleContactForm(e)),document.querySelectorAll("form[id*='inquiry'], form[id*='quote'], form[id*='application']").forEach(e=>{e.addEventListener("submit",e=>this.handleInquiryForm(e))}),document.querySelectorAll(".service-inquiry-form").forEach(e=>{e.addEventListener("submit",e=>this.handleServiceInquiry(e))}),document.querySelectorAll(".newsletter-form").forEach(e=>{e.addEventListener("submit",e=>this.handleNewsletterSignup(e))}),document.querySelectorAll(".quote-form").forEach(e=>{e.addEventListener("submit",e=>this.handleQuoteRequest(e))}),document.querySelectorAll("#checkout-form").forEach(e=>{e.addEventListener("submit",e=>this.handleCheckoutForm(e))})}handleContactForm(e){e.preventDefault();const t=new FormData(e.target),n={name:t.get("name")||"",email:t.get("email")||"",phone:t.get("phone")||"",company:t.get("company")||"",website:t.get("website")||"",industry:t.get("industry")||"",services:this.getSelectedServices(t),budget:t.get("budget")||"",timeline:t.get("timeline")||"",message:t.get("message")||"",additionalInfo:t.get("additionalInfo")||"",contactMethod:t.get("contactMethod")||"",source:"Contact Form",date:(new Date).toISOString().split("T")[0],status:"New"};this.processFormSubmission(n),this.showSuccessMessage("Thank you for your message! We'll get back to you soon.")}handleServiceInquiry(e){e.preventDefault();const t=new FormData(e.target),n=e.target.dataset.service||"General Inquiry",s={name:t.get("name")||"",email:t.get("email")||"",phone:t.get("phone")||"",company:t.get("company")||"",message:t.get("message")||"",services:[n],industry:t.get("industry")||"General",source:"Service Inquiry",date:(new Date).toISOString().split("T")[0],status:"New"};this.processFormSubmission(s),this.showSuccessMessage("Thank you for your interest! We'll contact you about our "+n+" services.")}handleNewsletterSignup(e){e.preventDefault();const t=new FormData(e.target),n={name:t.get("name")||"",email:t.get("email")||"",phone:"",company:"",message:"Newsletter signup",services:["Email Marketing"],industry:"General",source:"Newsletter Signup",date:(new Date).toISOString().split("T")[0],status:"New"};this.processFormSubmission(n),this.showSuccessMessage("Thank you for subscribing to our newsletter!")}handleQuoteRequest(e){e.preventDefault();const t=new FormData(e.target),n={name:t.get("name")||"",email:t.get("email")||"",phone:t.get("phone")||"",company:t.get("company")||"",message:t.get("message")||"",services:this.getSelectedServices(t),industry:t.get("industry")||"General",budget:t.get("budget")||"",timeline:t.get("timeline")||"",source:"Quote Request",date:(new Date).toISOString().split("T")[0],status:"New"};this.processFormSubmission(n),this.showSuccessMessage("Thank you for your quote request! We'll prepare a customized proposal for you.")}getSelectedServices(e){const t=[],n=e.getAll("services[]");return n.length>0&&t.push(...n),["web-design","seo","social-media","content-creation","paid-advertising","email-marketing"].forEach(n=>{e.get(n)&&t.push(this.formatServiceName(n))}),t.length>0?t:["General Inquiry"]}formatServiceName(e){return{"web-design":"Web Design",seo:"SEO Services","social-media":"Social Media Management","content-creation":"Content Creation","paid-advertising":"Paid Advertising","email-marketing":"Email Marketing"}[e]||e}async processFormSubmission(e){e.timestamp=(new Date).toISOString(),e.submissionDate=(new Date).toLocaleString(),e.submissionDateTime=(new Date).toISOString();let t=JSON.parse(localStorage.getItem("tnr_form_submissions")||"[]");e.id="submission-"+Date.now(),t.push(e),localStorage.setItem("tnr_form_submissions",JSON.stringify(t)),"undefined"!=typeof TNRCRMData&&(window.tnrCRM||(window.tnrCRM=new TNRCRMData),window.tnrCRM.formSubmissions=t,window.tnrCRM.saveToStorage(),window.tnrCRM.autoConvertSubmissionsToLeads([e]),window.tnrCRM.updateNotificationCount()),await this.sendEmailNotification(e),this.sendToServer(e)}async sendEmailNotification(e){try{window.tnrEmailService&&(await window.tnrEmailService.sendEmail(e)).success||this.createMailtoLink(e)}catch(t){this.createMailtoLink(e)}}createMailtoLink(e){const t=`mailto:roy.turner@tnrbusinesssolutions.com?subject=${encodeURIComponent(`New Contact Form Submission from ${e.name||"Unknown"}`)}&body=${encodeURIComponent(`\nNew Contact Form Submission\n\nName: ${e.name||"Not provided"}\nEmail: ${e.email||"Not provided"}\nPhone: ${e.phone||"Not provided"}\nCompany: ${e.company||"Not provided"}\nWebsite: ${e.website||"Not provided"}\nIndustry: ${e.industry||"Not specified"}\n\nServices of Interest:\n${Array.isArray(e.services)?e.services.join("\n- "):e.services||"Not specified"}\n\nMessage:\n${e.message||"No message provided"}\n\n---\nThis email was sent from the TNR Business Solutions contact form.\nTime: ${(new Date).toLocaleString()}\n    `.trim())}`;window.open(t)}async sendToServer(e){try{const t=await fetch("/submit-form",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return t.ok?await t.json():{success:!1,error:t.statusText}}catch(e){return{success:!1,error:e.message}}}showSuccessMessage(e){const t=document.createElement("div");t.className="form-success-notification",t.style.cssText="\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            background: #28a745;\n            color: white;\n            padding: 1rem 1.5rem;\n            border-radius: 6px;\n            box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n            z-index: 1000;\n            max-width: 300px;\n            animation: slideIn 0.3s ease;\n        ",t.textContent=e;const n=document.createElement("style");n.textContent="\n            @keyframes slideIn {\n                from { transform: translateX(100%); opacity: 0; }\n                to { transform: translateX(0); opacity: 1; }\n            }\n        ",document.head.appendChild(n),document.body.appendChild(t),setTimeout(()=>{t.remove(),n.remove()},5e3)}getFormSubmissions(){return JSON.parse(localStorage.getItem("tnr_form_submissions")||"[]")}clearFormSubmissions(){localStorage.removeItem("tnr_form_submissions"),window.tnrCRM&&(window.tnrCRM.formSubmissions=[],window.tnrCRM.saveToStorage())}handleInquiryForm(e){e.preventDefault();const t=new FormData(e.target),n=e.target.id;let s="General Inquiry",o="Website Form";n.includes("insurance")?(s="Insurance Inquiry",o="Insurance Quote Request"):n.includes("quote")?(s="Quote Request",o="Quote Request"):n.includes("application")&&(s="Job Application",o="Career Application");const i={name:t.get("name")||"",email:t.get("email")||"",phone:t.get("phone")||"",company:t.get("company")||"",website:t.get("website")||"",industry:t.get("industry")||"",services:this.getSelectedServices(t),budget:t.get("budget")||"",timeline:t.get("timeline")||"",message:t.get("message")||"",additionalInfo:t.get("additionalInfo")||"",contactMethod:t.get("contactMethod")||"",formType:s,source:o,date:(new Date).toISOString().split("T")[0],status:"New"};this.processFormSubmission(i),this.showSuccessMessage(`Thank you for your ${s.toLowerCase()}! We'll get back to you soon.`)}handleCheckoutForm(e){e.preventDefault();const t=new FormData(e.target),n={name:t.get("name")||"",email:t.get("email")||"",phone:t.get("phone")||"",company:t.get("company")||"",message:t.get("message")||"",services:this.getSelectedServices(t),formType:"Checkout",source:"Checkout Form",date:(new Date).toISOString().split("T")[0],status:"New"};this.processFormSubmission(n),this.showSuccessMessage("Thank you for your order! We'll process it and contact you soon.")}}window.tnrFormIntegration=new TNRFormIntegration;