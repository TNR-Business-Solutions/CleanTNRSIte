<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TNR Social Media Automation Dashboard</title>
    <link rel="stylesheet" href="assets/social-media-automation.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Social Media Automation Dashboard</h1>
            <p>Streamline your social media marketing for TNR Business Solutions & Clients</p>
        </div>
        
        <div class="dashboard-grid">
            <!-- Meta OAuth Setup -->
            <div class="card">
                <h3><span class="card-icon">üîê</span>Meta (Facebook/Instagram) Setup</h3>
                
                <div id="metaConnectionStatus">
                    <div class="connection-status">
                        <p id="metaStatus">Not connected</p>
                    </div>
                </div>
                
                <button class="btn" onclick="connectMeta()">üîó Connect Facebook/Instagram</button>
                <button class="btn btn-secondary" onclick="testMetaToken()">üß™ Test Token</button>
                
                <div class="form-group" style="margin-top: 20px;">
                    <label for="metaToken">Page Access Token (optional - for direct use):</label>
                    <input type="password" id="metaToken" placeholder="Paste your token here...">
                    <button class="btn" style="margin-top: 10px;" onclick="saveMetaToken()">üíæ Save Token</button>
                </div>
            </div>
            
            <!-- Content Generator -->
            <div class="card">
                <h3><span class="card-icon">üìù</span>Content Generator</h3>
                
                <div class="platform-tabs">
                    <div class="platform-tab active" onclick="switchPlatform('facebook')">Facebook</div>
                    <div class="platform-tab" onclick="switchPlatform('instagram')">Instagram</div>
                    <div class="platform-tab" onclick="switchPlatform('linkedin')">LinkedIn</div>
                    <div class="platform-tab" onclick="switchPlatform('twitter')">Twitter</div>
                </div>
                
                <div id="facebook" class="content-area active">
                    <div class="form-group">
                        <label for="contentType">Content Type</label>
                        <select id="contentType" name="contentType" aria-label="Select content type">
                            <option value="service-promotion">Service Promotion</option>
                            <option value="client-success">Client Success Story</option>
                            <option value="industry-tip">Industry Tip</option>
                            <option value="behind-scenes">Behind the Scenes</option>
                            <option value="local-news">Local News</option>
                            <option value="insurance-tip">Insurance Tip</option>
                            <option value="marketing-tip">Marketing Tip</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="professionType">Industry Type</label>
                        <select id="professionType" name="professionType" aria-label="Select industry type">
                            <option value="general">General Business</option>
                            <option value="blue-collar">Blue Collar (Construction, Trades, Manufacturing)</option>
                            <option value="white-collar">White Collar (Professional Services, Consulting)</option>
                            <option value="e-business">E-Business (Online, Digital, Tech)</option>
                            <option value="service-industry">Service Industry (Restaurant, Hospitality, Healthcare)</option>
                            <option value="retail">Retail & Sales</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="serviceFocus">Service Focus</label>
                        <select id="serviceFocus" name="serviceFocus" aria-label="Select service focus">
                            <option value="seo">SEO Services</option>
                            <option value="web-design">Web Design</option>
                            <option value="social-media">Social Media</option>
                            <option value="insurance">Insurance</option>
                            <option value="paid-ads">Paid Advertising</option>
                            <option value="email-marketing">Email Marketing</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="targetAudience">Target Audience</label>
                        <select id="targetAudience" name="targetAudience" aria-label="Select target audience">
                            <option value="small-business">Small Business Owners</option>
                            <option value="local-residents">Local Residents</option>
                            <option value="insurance-seekers">Insurance Seekers</option>
                            <option value="marketing-managers">Marketing Managers</option>
                        </select>
                    </div>
                    
                    <button class="btn" onclick="generateContent()">Generate Content</button>
                    
                    <div id="contentPreview" class="post-preview hidden" role="region" aria-label="Generated content preview">
                        <h4>Generated Post:</h4>
                        <div id="previewContent"></div>
                        <div class="hashtag-suggestions" id="hashtagSuggestions"></div>
                        <button class="btn" onclick="postToFacebook()" style="margin-top: 15px;">üì§ Post to Facebook</button>
                    </div>
                </div>
            </div>
            
            <!-- Post Scheduler -->
            <div class="card">
                <h3><span class="card-icon">üìÖ</span>Post Scheduler</h3>
                
                <div class="form-group">
                    <label for="schedulePlatform">Platform</label>
                    <select id="schedulePlatform" name="schedulePlatform" aria-label="Select platform">
                        <option value="facebook">Facebook</option>
                        <option value="instagram">Instagram</option>
                        <option value="linkedin">LinkedIn</option>
                        <option value="twitter">Twitter</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="scheduleContent">Post Content</label>
                    <textarea id="scheduleContent" name="scheduleContent" rows="4" placeholder="Enter your post content..." aria-label="Enter post content"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="scheduleDateTime">Schedule Date & Time</label>
                    <input type="datetime-local" id="scheduleDateTime" name="scheduleDateTime" aria-label="Select date and time">
                </div>
                
                <div class="form-group">
                    <label for="scheduleClient">Client (Optional)</label>
                    <select id="scheduleClient" name="scheduleClient" aria-label="Select client">
                        <option value="tnr">TNR Business Solutions</option>
                        <option value="client1">Client 1</option>
                        <option value="client2">Client 2</option>
                    </select>
                </div>
                
                <button class="btn" onclick="schedulePostReal()">Schedule Post (Real API)</button>
                <button class="btn btn-secondary" onclick="schedulePost()">Schedule Post (CSV Export)</button>
                
                <div id="scheduledPosts" class="schedule-grid"></div>
            </div>
            
            <!-- Hashtag Research -->
            <div class="card">
                <h3><span class="card-icon">#Ô∏è‚É£</span>Hashtag Research</h3>
                
                <div class="form-group">
                    <label for="hashtagIndustry">Industry/Service</label>
                    <select id="hashtagIndustry" name="hashtagIndustry" aria-label="Select industry or service">
                        <option value="digital-marketing">Digital Marketing</option>
                        <option value="insurance">Insurance</option>
                        <option value="web-design">Web Design</option>
                        <option value="seo">SEO</option>
                        <option value="social-media">Social Media</option>
                        <option value="local-business">Local Business</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="hashtagLocation">Location</label>
                    <input type="text" id="hashtagLocation" name="hashtagLocation" value="Greensburg PA" placeholder="Enter location" aria-label="Enter location">
                </div>
                
                <button class="btn" onclick="generateHashtags()">Generate Hashtags</button>
                
                <div id="hashtagResults" class="hashtag-suggestions"></div>
            </div>
            
            <!-- Client Management -->
            <div class="card">
                <h3><span class="card-icon">üë•</span>Client Management</h3>
                
                <div class="form-group">
                    <label for="newClientName">Add New Client</label>
                    <input type="text" id="newClientName" name="newClientName" placeholder="Client Name" aria-label="Enter client name">
                </div>
                
                <div class="form-group">
                    <label for="clientServices">Services</label>
                    <select id="clientServices" name="clientServices" multiple aria-label="Select services">
                        <option value="facebook">Facebook Management</option>
                        <option value="instagram">Instagram Management</option>
                        <option value="linkedin">LinkedIn Management</option>
                        <option value="content-creation">Content Creation</option>
                        <option value="scheduling">Post Scheduling</option>
                    </select>
                </div>
                
                <button class="btn" onclick="addClient()">Add Client</button>
                
                <div class="client-list" id="clientList">
                    <div class="client-item">
                        <div>
                            <div class="client-name">TNR Business Solutions</div>
                            <div class="client-services-text">All Platforms</div>
                        </div>
                        <span class="client-status status-active">Active</span>
                    </div>
                </div>
            </div>
            
            <!-- API Configuration -->
            <div class="card">
                <h3><span class="card-icon">üîß</span>API Configuration</h3>
                
                <div id="connectionStatus">
                    <div class="connection-status">
                        <h4>API Connection Status</h4>
                        <p>Configured: <span id="configStatus">‚ùå No</span></p>
                        <p>Meta (FB/IG): <span id="metaConnected">‚ùå</span></p>
                        <p>LinkedIn: <span id="linkedinConnected">‚ùå</span></p>
                        <p>Twitter: <span id="twitterConnected">‚ùå</span></p>
                    </div>
                </div>
                
                <button class="btn" onclick="showApiConfig()">Configure API Keys</button>
                <a href="real-automation-setup.html" class="btn btn-secondary">Advanced Setup ‚Üí</a>
            </div>
            
            <!-- Analytics Dashboard -->
            <div class="card">
                <h3><span class="card-icon">üìä</span>Analytics Dashboard</h3>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">1,247</div>
                        <div class="stat-label">Total Posts</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">15.2K</div>
                        <div class="stat-label">Total Reach</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">2,341</div>
                        <div class="stat-label">Engagements</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">18.7%</div>
                        <div class="stat-label">Engagement Rate</div>
                    </div>
                </div>
                
                <div class="export-options">
                    <button class="export-btn" onclick="exportToBuffer()">Export to Buffer</button>
                    <button class="export-btn" onclick="exportToHootsuite()">Export to Hootsuite</button>
                    <button class="export-btn" onclick="exportToLater()">Export to Later</button>
                    <button class="export-btn" onclick="exportToWebhook()">Export to Webhook</button>
                </div>
            </div>
            
            <!-- Content Calendar -->
            <div class="card">
                <h3><span class="card-icon">üìÜ</span>Content Calendar</h3>
                
                <div class="form-group">
                    <label for="calendarView">View</label>
                    <select id="calendarView" name="calendarView" aria-label="Select calendar view">
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                        <option value="quarter">This Quarter</option>
                    </select>
                </div>
                
                <div id="calendarContent">
                    <div class="schedule-item">
                        <div class="schedule-time">Today 9:00 AM</div>
                        <div class="schedule-content">Facebook: SEO Tips for Local Businesses</div>
                    </div>
                    <div class="schedule-item">
                        <div class="schedule-time">Today 2:00 PM</div>
                        <div class="schedule-content">Instagram: Behind the Scenes at TNR</div>
                    </div>
                    <div class="schedule-item">
                        <div class="schedule-time">Tomorrow 10:00 AM</div>
                        <div class="schedule-content">LinkedIn: Insurance Industry Insights</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="social-media-csv-export.js"></script>
    <script src="social-media-api-integration.js"></script>
    <script>
        // Check admin authentication
        if (sessionStorage.getItem('adminAuthenticated') !== 'true') {
            // For now, auto-authenticate for testing
            sessionStorage.setItem('adminAuthenticated', 'true');
        }
        
        // Meta OAuth Functions
        function connectMeta() {
            // Redirect to Meta OAuth flow
            window.location.href = '/auth/meta';
        }
        
        async function testMetaToken() {
            const token = document.getElementById('metaToken').value.trim() || localStorage.getItem('metaPageAccessToken');
            
            if (!token) {
                alert('Please paste your token or connect via OAuth first');
                return;
            }
            
            try {
                const response = await fetch('/api/social/test-token', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ pageAccessToken: token })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('metaStatus').innerHTML = `
                        ‚úÖ Connected to: ${data.page.name}<br>
                        ${data.instagram ? `üì∑ Instagram: @${data.instagram.username}` : ''}
                    `;
                    document.getElementById('metaConnected').textContent = '‚úÖ';
                    document.getElementById('configStatus').textContent = '‚úÖ Yes';
                    alert(`‚úÖ Token Valid!\n\nPage: ${data.page.name}\n${data.instagram ? `Instagram: @${data.instagram.username}` : 'No Instagram connected'}`);
                } else {
                    alert('‚ùå Token Invalid: ' + data.message);
                }
            } catch (error) {
                alert('‚ùå Error testing token: ' + error.message);
            }
        }
        
        function saveMetaToken() {
            const token = document.getElementById('metaToken').value.trim();
            if (token) {
                localStorage.setItem('metaPageAccessToken', token);
                alert('‚úÖ Token saved! Now test it to verify.');
                testMetaToken();
            } else {
                alert('Please paste your token first');
            }
        }
        
        async function postToFacebook() {
            const content = document.getElementById('previewContent').textContent;
            const token = localStorage.getItem('metaPageAccessToken');
            
            if (!token) {
                if (confirm('No token saved. Would you like to connect Facebook now?')) {
                    connectMeta();
                }
                return;
            }
            
            if (!content) {
                alert('Please generate content first');
                return;
            }
            
            try {
                const response = await fetch('/api/social/post-to-facebook', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        pageAccessToken: token,
                        message: content
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    if (confirm('üéâ Post published successfully!\n\nWould you like to view it on Facebook?')) {
                        window.open(data.postUrl, '_blank');
                    }
                } else {
                    alert('‚ùå Failed to post: ' + data.message);
                }
            } catch (error) {
                alert('‚ùå Error posting: ' + error.message);
            }
        }
        
        // Check if we have a saved token on load
        window.addEventListener('DOMContentLoaded', function() {
            const savedToken = localStorage.getItem('metaPageAccessToken');
            if (savedToken) {
                document.getElementById('metaToken').value = savedToken;
                testMetaToken();
            }
            
            // Set default date/time to tomorrow
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(9, 0, 0, 0);
            document.getElementById('scheduleDateTime').value = tomorrow.toISOString().slice(0, 16);
        });
        
        // Content templates (same as before)
        const contentTemplates = {
            'service-promotion': {
                facebook: "üöÄ Ready to grow your {service} in {location}? Our expert team at TNR Business Solutions has helped {number}+ local businesses achieve their goals! üíº\n\n‚úÖ Professional {service} services\n‚úÖ Proven results\n‚úÖ Local expertise\n\nCall (412) 499-2987 for a FREE consultation!\n\n#TNRBusinessSolutions #{service} #{location} #LocalBusiness"
            },
            'client-success': {
                facebook: "üéâ SUCCESS STORY! We're thrilled to share how we helped {client} increase their {metric} by {percentage}%! üìà\n\nOur {service} strategies delivered:\n‚úÖ {result1}\n‚úÖ {result2}\n‚úÖ {result3}\n\nReady for your success story? Contact TNR Business Solutions today!\n\n#SuccessStory #TNRBusinessSolutions #{service} #{location}"
            },
            'industry-tip': {
                facebook: "üí° PRO TIP: {tip}\n\nThis simple strategy can make a huge difference for your {industry} business! üíº\n\nWant more expert tips? Follow TNR Business Solutions for daily insights! üì±\n\n#ProTip #TNRBusinessSolutions #{industry} #BusinessTips #{location}"
            }
        };
        
        function switchPlatform(platform) {
            document.querySelectorAll('.platform-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.content-area').forEach(area => area.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(platform).classList.add('active');
        }
        
        function generateContent() {
            const contentType = document.getElementById('contentType').value;
            const template = contentTemplates[contentType]?.facebook || contentTemplates['service-promotion'].facebook;
            
            let content = template
                .replace(/{service}/g, 'Digital Marketing')
                .replace(/{location}/g, 'Greensburg PA')
                .replace(/{number}/g, Math.floor(Math.random() * 50) + 20)
                .replace(/{client}/g, 'Local Business')
                .replace(/{metric}/g, 'online visibility')
                .replace(/{percentage}/g, Math.floor(Math.random() * 200) + 50)
                .replace(/{result1}/g, 'Increased online visibility')
                .replace(/{result2}/g, 'Higher conversion rates')
                .replace(/{result3}/g, 'Better customer engagement')
                .replace(/{tip}/g, 'Focus on local keywords to improve your Google rankings')
                .replace(/{industry}/g, 'digital marketing');
            
            document.getElementById('previewContent').textContent = content;
            document.getElementById('contentPreview').classList.remove('hidden');
        }
        
        function generateHashtags() {
            const hashtagSets = {
                'digital-marketing': ['#DigitalMarketing', '#MarketingStrategy', '#BusinessGrowth', '#OnlineMarketing', '#MarketingTips'],
                'insurance': ['#Insurance', '#AutoInsurance', '#HomeInsurance', '#BusinessInsurance', '#LifeInsurance'],
                'web-design': ['#WebDesign', '#WebsiteDesign', '#WebDevelopment', '#ResponsiveDesign', '#UXDesign'],
                'seo': ['#SEO', '#SearchEngineOptimization', '#LocalSEO', '#SEOTips', '#GoogleRankings'],
                'social-media': ['#SocialMedia', '#SocialMediaMarketing', '#FacebookMarketing', '#InstagramMarketing', '#ContentCreation'],
                'local-business': ['#LocalBusiness', '#GreensburgPA', '#WestmorelandCounty', '#Pittsburgh', '#LocalMarketing']
            };
            
            const industry = document.getElementById('hashtagIndustry').value;
            const hashtags = hashtagSets[industry] || hashtagSets['digital-marketing'];
            const container = document.getElementById('hashtagResults');
            container.innerHTML = '';
            
            hashtags.forEach(hashtag => {
                const span = document.createElement('span');
                span.className = 'hashtag';
                span.textContent = hashtag;
                span.onclick = () => {
                    navigator.clipboard.writeText(hashtag);
                    alert('Copied: ' + hashtag);
                };
                container.appendChild(span);
            });
        }
        
        function addClient() {
            const clientName = document.getElementById('newClientName').value;
            if (!clientName) {
                alert('Please enter a client name');
                return;
            }
            
            const clientItem = document.createElement('div');
            clientItem.className = 'client-item';
            clientItem.innerHTML = `
                <div>
                    <div class="client-name">${clientName}</div>
                    <div style="font-size: 0.8rem; color: #6c757d;">New Client</div>
                </div>
                <span class="client-status status-active">Active</span>
            `;
            document.getElementById('clientList').appendChild(clientItem);
            document.getElementById('newClientName').value = '';
            alert('Client added successfully!');
        }
        
        function showApiConfig() {
            alert('API Configuration:\n\n1. Use "Connect Facebook/Instagram" button for Meta\n2. Visit test-facebook-posting.html to test your tokens\n3. Tokens are saved in browser localStorage');
        }
        
        function exportToBuffer() { alert('Export to Buffer feature coming soon!'); }
        function exportToHootsuite() { alert('Export to Hootsuite feature coming soon!'); }
        function exportToLater() { alert('Export to Later feature coming soon!'); }
        function exportToWebhook() { alert('Export to Webhook feature coming soon!'); }
        function schedulePostReal() { alert('Real-time scheduling coming soon!'); }
        function schedulePost() { alert('CSV Export coming soon!'); }
    </script>
</body>
</html>

