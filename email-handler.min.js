const nodemailer=require("nodemailer");require("dotenv").config();class EmailHandler{constructor(){if(!process.env.SMTP_USER||!process.env.SMTP_PASS)throw new Error("SMTP credentials not configured. Please set SMTP_USER and SMTP_PASS environment variables.");this.transporter=nodemailer.createTransport({host:process.env.SMTP_HOST||"smtp.gmail.com",port:process.env.SMTP_PORT||587,secure:!1,auth:{user:process.env.SMTP_USER,pass:process.env.SMTP_PASS}})}async sendContactFormEmail(n){try{const e={from:`"TNR Business Solutions Contact Form" <${process.env.SMTP_USER}>`,to:process.env.BUSINESS_EMAIL||"roy.turner@tnrbusinesssolutions.com",subject:`New Contact Form Submission from ${n.name||"Unknown"}`,html:this.formatEmailHTML(n),text:this.formatEmailText(n)};return{success:!0,messageId:(await this.transporter.sendMail(e)).messageId}}catch(n){return{success:!1,error:n.message}}}formatEmailHTML(n){return`\n<!DOCTYPE html>\n<html>\n<head>\n    <style>\n        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n        .container { max-width: 600px; margin: 0 auto; padding: 20px; }\n        .header { background: #2c5530; color: white; padding: 20px; text-align: center; }\n        .content { background: #f9f9f9; padding: 20px; }\n        .field { margin-bottom: 15px; }\n        .label { font-weight: bold; color: #2c5530; }\n        .value { margin-left: 10px; }\n        .footer { background: #2c5530; color: white; padding: 15px; text-align: center; font-size: 12px; }\n    </style>\n</head>\n<body>\n    <div class="container">\n        <div class="header">\n            <h2>New Contact Form Submission</h2>\n            <p>TNR Business Solutions Website</p>\n        </div>\n        <div class="content">\n            <div class="field">\n                <span class="label">Name:</span>\n                <span class="value">${n.name||"Not provided"}</span>\n            </div>\n            <div class="field">\n                <span class="label">Email:</span>\n                <span class="value">${n.email||"Not provided"}</span>\n            </div>\n            <div class="field">\n                <span class="label">Phone:</span>\n                <span class="value">${n.phone||"Not provided"}</span>\n            </div>\n            <div class="field">\n                <span class="label">Company:</span>\n                <span class="value">${n.company||"Not provided"}</span>\n            </div>\n            <div class="field">\n                <span class="label">Website:</span>\n                <span class="value">${n.website||"Not provided"}</span>\n            </div>\n            <div class="field">\n                <span class="label">Industry:</span>\n                <span class="value">${n.industry||"Not specified"}</span>\n            </div>\n            <div class="field">\n                <span class="label">Services of Interest:</span>\n                <span class="value">${Array.isArray(n.services)?n.services.join(", "):n.services||"Not specified"}</span>\n            </div>\n            <div class="field">\n                <span class="label">Project Budget:</span>\n                <span class="value">${n.budget||"Not specified"}</span>\n            </div>\n            <div class="field">\n                <span class="label">Project Timeline:</span>\n                <span class="value">${n.timeline||"Not specified"}</span>\n            </div>\n            <div class="field">\n                <span class="label">Preferred Contact Method:</span>\n                <span class="value">${n.contactMethod||"Not specified"}</span>\n            </div>\n            <div class="field">\n                <span class="label">Message:</span>\n                <div class="value" style="margin-top: 10px; padding: 10px; background: white; border-left: 3px solid #2c5530;">\n                    ${(n.message||"No message provided").replace(/\n/g,"<br>")}\n                </div>\n            </div>\n            ${n.additionalInfo?`\n            <div class="field">\n                <span class="label">Additional Information:</span>\n                <div class="value" style="margin-top: 10px; padding: 10px; background: white; border-left: 3px solid #2c5530;">\n                    ${n.additionalInfo.replace(/\n/g,"<br>")}\n                </div>\n            </div>\n            `:""}\n        </div>\n        <div class="footer">\n            <p>This email was sent from the TNR Business Solutions contact form.</p>\n            <p>Submission Time: ${n.submissionDate||(new Date).toLocaleString()}</p>\n            <p>Server Submission Time: ${n.submissionDate||(new Date).toLocaleString()}\nServer Time: ${(new Date).toLocaleString()}</p>\n            <p>Reply directly to this email to respond to the customer.</p>\n        </div>\n    </div>\n</body>\n</html>\n        `}formatEmailText(n){return`\nNew Contact Form Submission\n\nName: ${n.name||"Not provided"}\nEmail: ${n.email||"Not provided"}\nPhone: ${n.phone||"Not provided"}\nCompany: ${n.company||"Not provided"}\nWebsite: ${n.website||"Not provided"}\nIndustry: ${n.industry||"Not specified"}\n\nServices of Interest:\n${Array.isArray(n.services)?n.services.join("\n- "):n.services||"Not specified"}\n\nProject Budget: ${n.budget||"Not specified"}\nProject Timeline: ${n.timeline||"Not specified"}\nPreferred Contact Method: ${n.contactMethod||"Not specified"}\n\nMessage:\n${n.message||"No message provided"}\n\n${n.additionalInfo?`\nAdditional Information:\n${n.additionalInfo}\n`:""}\n\n---\nThis email was sent from the TNR Business Solutions contact form.\nSubmission Time: ${n.submissionDate||(new Date).toLocaleString()}\nServer Time: ${(new Date).toLocaleString()}\nReply directly to this email to respond to the customer.\n        `.trim()}}module.exports=EmailHandler;