const nodemailer=require("nodemailer");require("dotenv").config();let carts=new Map;const createTransporter=()=>{if(!process.env.SMTP_USER||!process.env.SMTP_PASS)throw new Error("SMTP credentials not configured. Please set SMTP_USER and SMTP_PASS environment variables.");return nodemailer.createTransport({host:process.env.SMTP_HOST||"smtp.gmail.com",port:process.env.SMTP_PORT||587,secure:!1,auth:{user:process.env.SMTP_USER,pass:process.env.SMTP_PASS}})},services={"basic-website":{id:"basic-website",name:"Basic Website Package",price:300,category:"Digital Marketing",description:"Professional website with 5 pages, mobile responsive design, and basic SEO",features:["5 Pages","Mobile Responsive","Basic SEO","Contact Form","1 Month Support"]},"premium-website":{id:"premium-website",name:"Premium Website Package",price:800,category:"Digital Marketing",description:"Advanced website with 10 pages, e-commerce integration, and comprehensive SEO",features:["10 Pages","E-commerce Ready","Advanced SEO","Analytics Setup","3 Months Support"]},"ecommerce-package":{id:"ecommerce-package",name:"E-commerce Package",price:2500,category:"Digital Marketing",description:"Complete e-commerce solution with payment processing and inventory management",features:["Unlimited Products","Payment Processing","Inventory Management","Order Tracking","6 Months Support"]},"seo-optimization":{id:"seo-optimization",name:"SEO Optimization",price:200,category:"A La Carte",description:"Comprehensive SEO audit and optimization for your website",features:["Keyword Research","On-Page Optimization","Technical SEO","Performance Analysis"]},"social-media-setup":{id:"social-media-setup",name:"Social Media Setup",price:150,category:"A La Carte",description:"Complete social media profile setup and content strategy",features:["Profile Optimization","Content Calendar","Brand Guidelines","Posting Schedule"]},"email-marketing-setup":{id:"email-marketing-setup",name:"Email Marketing Setup",price:180,category:"A La Carte",description:"Email marketing platform setup with templates and automation",features:["Platform Setup","Email Templates","Automation Workflows","List Management"]},"google-ads-setup":{id:"google-ads-setup",name:"Google Ads Setup",price:250,category:"A La Carte",description:"Google Ads campaign setup and optimization",features:["Campaign Creation","Keyword Research","Ad Copy Writing","Landing Page Optimization"]},"content-creation":{id:"content-creation",name:"Content Creation",price:100,category:"A La Carte",description:"Professional content creation for your marketing needs",features:["Blog Posts","Social Media Content","Website Copy","Marketing Materials"]},"analytics-setup":{id:"analytics-setup",name:"Analytics Setup",price:120,category:"A La Carte",description:"Complete analytics and tracking setup for your business",features:["Google Analytics","Conversion Tracking","Custom Reports","Data Analysis"]}},getCart=e=>(carts.has(e)||carts.set(e,{items:[],total:0,createdAt:new Date}),carts.get(e)),addToCart=(e,t,r=1)=>{const a=getCart(e),o=services[t];if(!o)return{success:!1,message:"Service not found"};const n=a.items.find(e=>e.id===t);return n?n.quantity+=r:a.items.push({...o,quantity:r}),updateCartTotal(a),{success:!0,message:"Item added to cart",cart:a}},removeFromCart=(e,t)=>{const r=getCart(e);return r.items=r.items.filter(e=>e.id!==t),updateCartTotal(r),{success:!0,message:"Item removed from cart",cart:r}},updateCartItem=(e,t,r)=>{const a=getCart(e),o=a.items.find(e=>e.id===t);if(o){if(r<=0)return removeFromCart(e,t);o.quantity=r,updateCartTotal(a)}return{success:!0,message:"Cart updated",cart:a}},clearCart=e=>(carts.set(e,{items:[],total:0,createdAt:new Date}),{success:!0,message:"Cart cleared"}),updateCartTotal=e=>{e.total=e.items.reduce((e,t)=>e+t.price*t.quantity,0)},processCheckout=async(e,t,r,a=null)=>{let o;if(o=a&&a.length>0?{items:a,total:a.reduce((e,t)=>e+t.price*t.quantity,0),createdAt:new Date}:getCart(e),0===o.items.length)return{success:!1,message:"Cart is empty"};try{const a=`TNR-${Date.now()}-${Math.random().toString(36).substr(2,9).toUpperCase()}`,n={orderNumber:a,customerInfo:t,items:o.items,total:o.total,status:"confirmed",createdAt:new Date,paymentMethod:r.method||"Credit Card"};return await sendOrderConfirmation(n),clearCart(e),{success:!0,message:"Order processed successfully",orderNumber:a,order:n}}catch(e){return{success:!1,message:"Checkout failed: "+e.message}}},sendOrderConfirmation=async e=>{const t=createTransporter(),r=e.items.map(e=>`\n    <div style="border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px;">\n      <h4 style="margin: 0 0 10px 0; color: #2c5530;">${e.name}</h4>\n      <p style="margin: 5px 0; color: #666;">${e.description}</p>\n      <p style="margin: 5px 0;"><strong>Quantity:</strong> ${e.quantity}</p>\n      <p style="margin: 5px 0;"><strong>Price:</strong> $${e.price.toFixed(2)} each</p>\n      <p style="margin: 5px 0;"><strong>Subtotal:</strong> $${(e.price*e.quantity).toFixed(2)}</p>\n    </div>\n  `).join(""),a={from:process.env.SMTP_USER,to:e.customerInfo.email,subject:`Order Confirmation - ${e.orderNumber}`,html:`\n      <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">\n        <h2 style="color: #2c5530; text-align: center;">Order Confirmation</h2>\n        <p>Dear ${e.customerInfo.firstName} ${e.customerInfo.lastName},</p>\n        \n        <p>Thank you for your order! We're excited to work with you on your digital marketing needs.</p>\n        \n        <div style="background-color: #f5f5f5; padding: 20px; border-radius: 5px; margin: 20px 0;">\n          <h3 style="margin-top: 0; color: #2c5530;">Order Details</h3>\n          <p><strong>Order Number:</strong> ${e.orderNumber}</p>\n          <p><strong>Order Date:</strong> ${e.createdAt.toLocaleDateString()}</p>\n          <p><strong>Payment Method:</strong> ${e.paymentMethod}</p>\n        </div>\n        \n        <h3 style="color: #2c5530;">Items Ordered</h3>\n        ${r}\n        \n        <div style="background-color: #2c5530; color: white; padding: 20px; border-radius: 5px; margin: 20px 0;">\n          <h3 style="margin-top: 0; text-align: center;">Total: $${e.total.toFixed(2)}</h3>\n        </div>\n        \n        <h3 style="color: #2c5530;">Next Steps</h3>\n        <p>Our team will contact you within 24 hours to discuss your project details and get started. We'll need to gather some additional information about your business and goals.</p>\n        \n        <p>If you have any questions about your order, please don't hesitate to contact us at <a href="mailto:Roy.Turner@tnrbusinesssolutions.com">Roy.Turner@tnrbusinesssolutions.com</a> or call us at (412) 499-2987.</p>\n        \n        <p>Thank you for choosing TNR Business Solutions!</p>\n        \n        <hr style="margin: 30px 0;">\n        <p style="font-size: 12px; color: #666; text-align: center;">\n          TNR Business Solutions<br>\n          418 Concord Avenue, Greensburg, PA 15601<br>\n          Phone: (412) 499-2987 | Email: Roy.Turner@tnrbusinesssolutions.com\n        </p>\n      </div>\n    `};await t.sendMail(a);const o={from:process.env.SMTP_USER,to:process.env.BUSINESS_EMAIL,subject:`New Order Received - ${e.orderNumber}`,html:`\n      <h2>New Order Received</h2>\n      <p><strong>Order Number:</strong> ${e.orderNumber}</p>\n      <p><strong>Customer:</strong> ${e.customerInfo.firstName} ${e.customerInfo.lastName}</p>\n      <p><strong>Email:</strong> ${e.customerInfo.email}</p>\n      <p><strong>Phone:</strong> ${e.customerInfo.phone}</p>\n      <p><strong>Total:</strong> $${e.total.toFixed(2)}</p>\n      \n      <h3>Items:</h3>\n      ${r}\n      \n      <p><strong>Action Required:</strong> Contact customer within 24 hours to begin project.</p>\n    `};await t.sendMail(o)};module.exports={getCart:getCart,addToCart:addToCart,removeFromCart:removeFromCart,updateCartItem:updateCartItem,clearCart:clearCart,processCheckout:processCheckout,services:services};