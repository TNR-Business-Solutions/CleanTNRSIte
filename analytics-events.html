<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analytics Events - TNR Admin Dashboard</title>
    <link rel="stylesheet" href="assets/styles.css" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --tnr-navy: #1a237e;
        --tnr-primary: #3f51b5;
        --tnr-secondary: #7986cb;
        --tnr-gold: #ffd700;
        --tnr-success: #4caf50;
        --tnr-warning: #ff9800;
        --tnr-danger: #f44336;
        --tnr-info: #2196f3;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(
          135deg,
          var(--tnr-primary),
          var(--tnr-secondary)
        );
        min-height: 100vh;
      }

      .page-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 2rem;
      }

      .page-header {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 2rem;
        margin-bottom: 2rem;
        color: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
      }

      .page-header h1 {
        color: var(--tnr-gold);
        font-size: 2rem;
        margin: 0;
      }

      .btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
      }

      .btn-primary {
        background: var(--tnr-gold);
        color: var(--tnr-navy);
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4);
      }

      .btn-secondary {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.3);
      }

      .btn-secondary:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      .stat-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 1.5rem;
        color: white;
        text-align: center;
      }

      .stat-card .stat-icon {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
      }

      .stat-card .stat-value {
        font-size: 2rem;
        font-weight: bold;
        color: var(--tnr-gold);
        margin-bottom: 0.25rem;
      }

      .stat-card .stat-label {
        opacity: 0.8;
        font-size: 0.9rem;
      }

      .filters-section {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 2rem;
      }

      .filters-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
      }

      .filter-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .filter-group label {
        color: white;
        font-weight: 600;
        font-size: 0.9rem;
      }

      .filter-group select,
      .filter-group input {
        padding: 0.75rem;
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.1);
        color: white;
        font-size: 1rem;
      }

      .events-list {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 2rem;
      }

      .event-item {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        color: white;
        transition: all 0.3s ease;
        border-left: 4px solid var(--tnr-info);
      }

      .event-item:hover {
        background: rgba(255, 255, 255, 0.1);
        transform: translateX(5px);
      }

      .event-item.pageview {
        border-left-color: var(--tnr-info);
      }

      .event-item.click {
        border-left-color: var(--tnr-success);
      }

      .event-item.conversion {
        border-left-color: var(--tnr-gold);
      }

      .event-item.error {
        border-left-color: var(--tnr-danger);
      }

      .event-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 1rem;
        flex-wrap: wrap;
        gap: 1rem;
      }

      .event-type {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 600;
      }

      .event-date {
        opacity: 0.7;
        font-size: 0.9rem;
      }

      .event-details {
        margin-bottom: 1rem;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
      }

      .event-meta {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        font-size: 0.85rem;
        opacity: 0.8;
      }

      .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        color: white;
        opacity: 0.7;
      }

      .empty-state-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
      }

      .loading-state {
        text-align: center;
        padding: 3rem;
        color: white;
      }

      .loading-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
        animation: spin 2s linear infinite;
      }

      @keyframes spin {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }

      /* Admin Header Styles */
      .admin-header {
        background: linear-gradient(
          135deg,
          var(--tnr-navy) 0%,
          var(--tnr-primary) 100%
        );
        color: white;
        padding: 1rem 2rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        position: sticky;
        top: 0;
        z-index: 1000;
        margin-bottom: 0;
      }

      .admin-header-inner {
        max-width: 1400px;
        margin: 0 auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
      }

      .admin-header-logo {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-size: 1.25rem;
        font-weight: bold;
        text-decoration: none;
        color: white;
      }

      .admin-header-logo img {
        height: 35px;
      }

      .admin-header-menu {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        align-items: center;
      }

      .admin-header-link {
        color: white;
        text-decoration: none;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        transition: all 0.3s ease;
        font-size: 0.95rem;
        font-weight: 500;
        white-space: nowrap;
      }

      .admin-header-link:hover {
        background: rgba(255, 255, 255, 0.15);
        transform: translateY(-2px);
      }

      .admin-header-link.active {
        background: var(--tnr-gold);
        color: var(--tnr-navy);
      }

      @media (max-width: 768px) {
        .page-container {
          padding: 1rem;
        }

        .filters-grid {
          grid-template-columns: 1fr;
        }

        .event-header {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <!-- Admin Header Menu -->
    <header class="admin-header">
      <div class="admin-header-inner">
        <a href="/" class="admin-header-logo">
          <img
            src="media/logo.png"
            alt="TNR Business Solutions Logo"
            loading="lazy"
          />
          <span>TNR Business Solutions</span>
        </a>
        <nav class="admin-header-menu">
          <a href="/" class="admin-header-link">üè† Home</a>
          <a href="/admin-dashboard-v2.html" class="admin-header-link"
            >üìä Admin Dashboard</a
          >
          <a href="/platform-connections.html" class="admin-header-link"
            >üåê Platforms</a
          >
          <a href="/posts-management.html" class="admin-header-link"
            >üìù Posts</a
          >
          <a href="/messages-management.html" class="admin-header-link"
            >üí¨ Messages</a
          >
          <a href="/analytics-events.html" class="admin-header-link active"
            >üìä Analytics</a
          >
          <a href="/admin-orders.html" class="admin-header-link">üì¶ Orders</a>
          <a
            href="/social-media-automation-dashboard.html"
            class="admin-header-link"
            >üì± Social Media</a
          >
          <a href="/admin-login.html" class="admin-header-link">üîê Login</a>
          <a href="javascript:void(0)" class="admin-header-link" onclick="logout()">üö™ Logout</a>
        </nav>
      </div>
    </header>

    <div class="page-container">
      <!-- Page Header -->
      <div class="page-header">
        <div>
          <h1>üìä Analytics Events</h1>
          <p style="opacity: 0.8; margin-top: 0.5rem">
            Track and analyze all analytics events
          </p>
        </div>
        <div>
          <a href="/admin-dashboard-v2.html" class="btn btn-secondary"
            >‚Üê Back to Dashboard</a
          >
          <button
            class="btn btn-secondary"
            onclick="exportEvents('csv')"
            style="margin-left: 0.5rem"
          >
            üì• Export CSV
          </button>
          <button
            class="btn btn-secondary"
            onclick="exportEvents('json')"
            style="margin-left: 0.5rem"
          >
            üì• Export JSON
          </button>
          <button
            class="btn btn-primary"
            onclick="refreshEvents()"
            style="margin-left: 0.5rem"
          >
            üîÑ Refresh
          </button>
        </div>
      </div>

      <!-- Stats Overview -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">üìä</div>
          <div class="stat-value" id="total-events-count">0</div>
          <div class="stat-label">Total Events</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üëÅÔ∏è</div>
          <div class="stat-value" id="pageviews">0</div>
          <div class="stat-label">Page Views</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üñ±Ô∏è</div>
          <div class="stat-value" id="clicks">0</div>
          <div class="stat-label">Clicks</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üéØ</div>
          <div class="stat-value" id="conversions">0</div>
          <div class="stat-label">Conversions</div>
        </div>
      </div>

      <!-- Filters -->
      <div class="filters-section">
        <div class="filters-grid">
          <div class="filter-group">
            <label for="event-type-filter">Event Type</label>
            <select id="event-type-filter" onchange="filterEvents()">
              <option value="">All Types</option>
              <option value="pageview">Page View</option>
              <option value="click">Click</option>
              <option value="conversion">Conversion</option>
              <option value="form_submit">Form Submit</option>
              <option value="download">Download</option>
              <option value="error">Error</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="date-filter">Date Range</label>
            <select id="date-filter" onchange="filterEvents()">
              <option value="today">Today</option>
              <option value="last-7-days">Last 7 Days</option>
              <option value="last-30-days">Last 30 Days</option>
              <option value="this-month">This Month</option>
              <option value="all">All Time</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="page-filter">Page</label>
            <input
              type="text"
              id="page-filter"
              placeholder="Filter by page..."
              onkeyup="filterEvents()"
            />
          </div>
          <div class="filter-group">
            <label for="search-events">Search</label>
            <input
              type="text"
              id="search-events"
              placeholder="Search events..."
              onkeyup="filterEvents()"
            />
          </div>
        </div>
      </div>

      <!-- Events List -->
      <div class="events-list">
        <div id="events-container">
          <div class="loading-state">
            <div class="loading-icon">‚è≥</div>
            <p>Loading analytics events...</p>
          </div>
        </div>
        <!-- Pagination -->
        <div
          id="events-pagination"
          style="
            display: none;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
          "
        >
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              flex-wrap: wrap;
              gap: 1rem;
            "
          >
            <div style="color: white; opacity: 0.8">
              <span id="events-pagination-info">Showing 0-0 of 0</span>
            </div>
            <div style="display: flex; gap: 0.5rem">
              <button
                id="events-prev-btn"
                class="btn btn-secondary btn-small"
                onclick="loadPreviousPage()"
                disabled
              >
                ‚Üê Previous
              </button>
              <button
                id="events-next-btn"
                class="btn btn-secondary btn-small"
                onclick="loadNextPage()"
                disabled
              >
                Next ‚Üí
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      let allEvents = [];
      let filteredEvents = [];
      let currentPage = 0;
      let pageSize = 50;
      let totalEvents = 0;
      let paginationData = null;

      // Load events from API
      async function loadEvents(page = 0) {
        try {
          currentPage = page;
          const offset = page * pageSize;
          const response = await fetch(
            `/api/analytics/events?dateRange=today&limit=${pageSize}&offset=${offset}`
          );
          const data = await response.json();

          if (data.success && data.data) {
            filteredEvents = data.data;
            paginationData = data.pagination || null;
            totalEvents = paginationData
              ? paginationData.total
              : filteredEvents.length;

            if (page === 0) {
              allEvents = [...filteredEvents];
            }
          } else {
            filteredEvents = [];
            paginationData = null;
            totalEvents = 0;
          }

          updateStats();
          renderEvents();
          updatePagination();
        } catch (error) {
          console.error("Error loading events:", error);
          filteredEvents = [];
          paginationData = null;
          totalEvents = 0;
          updateStats();
          renderEvents();
          updatePagination();
        }
      }

      function updateStats() {
        const total = allEvents.length;
        const pageviews = allEvents.filter(
          (e) => e.eventType === "pageview"
        ).length;
        const clicks = allEvents.filter((e) => e.eventType === "click").length;
        const conversions = allEvents.filter(
          (e) => e.eventType === "conversion"
        ).length;

        document.getElementById("total-events-count").textContent = total;
        document.getElementById("pageviews").textContent = pageviews;
        document.getElementById("clicks").textContent = clicks;
        document.getElementById("conversions").textContent = conversions;
      }

      async function filterEvents() {
        const eventType = document.getElementById("event-type-filter").value;
        const dateRange = document.getElementById("date-filter").value;
        const page = document.getElementById("page-filter").value;
        const search = document.getElementById("search-events").value;

        // Build API query
        const params = new URLSearchParams();
        if (eventType) params.append("eventType", eventType);
        if (dateRange) params.append("dateRange", dateRange);
        if (page) params.append("page", page);
        if (search) params.append("search", search);

        try {
          const response = await fetch(
            `/api/analytics/events?${params.toString()}`
          );
          const data = await response.json();

          if (data.success && data.data) {
            filteredEvents = data.data;
          } else {
            filteredEvents = [];
          }

          renderEvents();
        } catch (error) {
          console.error("Error filtering events:", error);
          // Fallback to client-side filtering
          const now = new Date();
          let startDate = new Date(
            now.getFullYear(),
            now.getMonth(),
            now.getDate()
          );

          if (dateRange === "last-7-days") {
            startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
          } else if (dateRange === "last-30-days") {
            startDate = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
          } else if (dateRange === "this-month") {
            startDate = new Date(now.getFullYear(), now.getMonth(), 1);
          } else if (dateRange === "all") {
            startDate = new Date(0);
          }

          filteredEvents = allEvents.filter((event) => {
            const eventDate = new Date(
              event.timestamp || event.createdAt || event.created_at
            );
            const matchesType = !eventType || event.eventType === eventType;
            const matchesDate = eventDate >= startDate;
            const matchesPage =
              !page ||
              (event.page &&
                event.page.toLowerCase().includes(page.toLowerCase()));
            const matchesSearch =
              !search ||
              (event.eventType &&
                event.eventType.toLowerCase().includes(search.toLowerCase())) ||
              (event.page &&
                event.page.toLowerCase().includes(search.toLowerCase())) ||
              (event.description &&
                event.description.toLowerCase().includes(search.toLowerCase()));

            return matchesType && matchesDate && matchesPage && matchesSearch;
          });

          renderEvents();
          updatePagination();
        }
      }

      function updatePagination() {
        const paginationDiv = document.getElementById("events-pagination");
        const prevBtn = document.getElementById("events-prev-btn");
        const nextBtn = document.getElementById("events-next-btn");
        const infoSpan = document.getElementById("events-pagination-info");

        if (!paginationData || totalEvents === 0) {
          paginationDiv.style.display = "none";
          return;
        }

        paginationDiv.style.display = "block";
        const start = currentPage * pageSize + 1;
        const end = Math.min((currentPage + 1) * pageSize, totalEvents);
        infoSpan.textContent = `Showing ${start}-${end} of ${totalEvents}`;

        prevBtn.disabled = currentPage === 0;
        nextBtn.disabled = !paginationData.hasMore;
      }

      function loadPreviousPage() {
        if (currentPage > 0) {
          filterEvents(currentPage - 1);
        }
      }

      function loadNextPage() {
        if (paginationData && paginationData.hasMore) {
          filterEvents(currentPage + 1);
        }
      }

      function updatePagination() {
        const paginationDiv = document.getElementById("events-pagination");
        const prevBtn = document.getElementById("events-prev-btn");
        const nextBtn = document.getElementById("events-next-btn");
        const infoSpan = document.getElementById("events-pagination-info");

        if (!paginationData || totalEvents === 0) {
          paginationDiv.style.display = "none";
          return;
        }

        paginationDiv.style.display = "block";
        const start = currentPage * pageSize + 1;
        const end = Math.min((currentPage + 1) * pageSize, totalEvents);
        infoSpan.textContent = `Showing ${start}-${end} of ${totalEvents}`;

        prevBtn.disabled = currentPage === 0;
        nextBtn.disabled = !paginationData.hasMore;
      }

      function loadPreviousPage() {
        if (currentPage > 0) {
          filterEvents(currentPage - 1);
        }
      }

      function loadNextPage() {
        if (paginationData && paginationData.hasMore) {
          filterEvents(currentPage + 1);
        }
      }

      function renderEvents() {
        const container = document.getElementById("events-container");

        if (filteredEvents.length === 0) {
          container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìä</div>
                        <h3>No Analytics Events Found</h3>
                        <p>No events match your current filters, or no analytics events have been tracked yet.</p>
                        <p style="margin-top: 1rem;">
                            <a href="/admin/analytics/" class="btn btn-primary" style="margin-top: 1rem;">
                                View Analytics Dashboard
                            </a>
                        </p>
                    </div>
                `;
          return;
        }

        container.innerHTML = filteredEvents
          .map((event) => {
            const eventIcons = {
              pageview: "üëÅÔ∏è",
              click: "üñ±Ô∏è",
              conversion: "üéØ",
              form_submit: "üìù",
              download: "‚¨áÔ∏è",
              error: "‚ùå",
            };

            const date = new Date(
              event.timestamp || event.createdAt || event.created_at
            );
            const formattedDate =
              date.toLocaleDateString() +
              " " +
              date.toLocaleTimeString([], {
                hour: "2-digit",
                minute: "2-digit",
              });

            const eventTypeClass = event.eventType || "pageview";

            return `
                    <div class="event-item ${eventTypeClass}">
                        <div class="event-header">
                            <div class="event-type">
                                <span>${
                                  eventIcons[eventTypeClass] || "üìä"
                                }</span>
                                <span>${
                                  eventTypeClass
                                    ? eventTypeClass.charAt(0).toUpperCase() +
                                      eventTypeClass.slice(1).replace("_", " ")
                                    : "Unknown Event"
                                }</span>
                            </div>
                            <div class="event-date">${formattedDate}</div>
                        </div>
                        <div class="event-details">
                            ${
                              event.description ||
                              event.name ||
                              "Analytics event"
                            }
                            ${
                              event.page
                                ? `<div style="margin-top: 0.5rem; opacity: 0.8;">Page: ${escapeHtml(
                                    event.page
                                  )}</div>`
                                : ""
                            }
                        </div>
                        <div class="event-meta">
                            ${
                              event.userId
                                ? `<span>User: ${event.userId}</span>`
                                : ""
                            }
                            ${
                              event.sessionId
                                ? `<span>Session: ${event.sessionId.substring(
                                    0,
                                    8
                                  )}...</span>`
                                : ""
                            }
                            ${
                              event.value
                                ? `<span>Value: ${event.value}</span>`
                                : ""
                            }
                        </div>
                    </div>
                `;
          })
          .join("");
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      function refreshEvents() {
        document.getElementById("events-container").innerHTML = `
                <div class="loading-state">
                    <div class="loading-icon">‚è≥</div>
                    <p>Refreshing events...</p>
                </div>
            `;
        loadEvents(0);
      }

      async function exportEvents(format) {
        try {
          const eventType = document.getElementById("event-type-filter").value;
          const dateRange = document.getElementById("date-filter").value;
          const pageFilter = document.getElementById("page-filter").value;
          const search = document.getElementById("search-events").value;

          const params = new URLSearchParams();
          if (eventType) params.append("eventType", eventType);
          if (dateRange) params.append("dateRange", dateRange);
          if (pageFilter) params.append("page", pageFilter);
          if (search) params.append("search", search);
          params.append("limit", "10000");
          params.append("offset", "0");

          const response = await fetch(
            `/api/analytics/events?${params.toString()}`
          );
          const data = await response.json();

          if (!data.success || !data.data) {
            alert("No events to export");
            return;
          }

          const events = data.data;
          const now = new Date().toISOString().split("T")[0];

          if (format === "csv") {
            const headers = [
              "ID",
              "Event Type",
              "Description",
              "Page",
              "User ID",
              "Session ID",
              "Timestamp",
              "Value",
              "Created At",
            ];
            const rows = events.map((event) => [
              event.id || "",
              event.eventType || "",
              (event.description || "").replace(/"/g, '""'),
              event.page || "",
              event.userId || "",
              event.sessionId || "",
              event.timestamp || "",
              event.value || "",
              event.createdAt || "",
            ]);

            const csvContent = [
              headers.join(","),
              ...rows.map((row) => row.map((cell) => `"${cell}"`).join(",")),
            ].join("\n");

            const blob = new Blob([csvContent], {
              type: "text/csv;charset=utf-8;",
            });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = `analytics-events-export-${now}.csv`;
            link.click();
          } else if (format === "json") {
            const jsonContent = JSON.stringify(events, null, 2);
            const blob = new Blob([jsonContent], {
              type: "application/json;charset=utf-8;",
            });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = `analytics-events-export-${now}.json`;
            link.click();
          }
        } catch (error) {
          console.error("Error exporting events:", error);
          alert("Error exporting events: " + error.message);
        }
      }

      function logout() {
        if (confirm("Are you sure you want to logout?")) {
          localStorage.removeItem("adminSession");
          localStorage.removeItem("adminRefreshToken");
          localStorage.removeItem("sessionExpiry");
          localStorage.removeItem("adminUsername");
          localStorage.removeItem("adminRole");
          sessionStorage.removeItem("adminAuthenticated");
          sessionStorage.removeItem("adminSessionToken");
          window.location.href = "/admin-login.html";
        }
      }

      // Authentication check
      function checkAuthentication() {
        const sessionToken =
          localStorage.getItem("adminSession") ||
          sessionStorage.getItem("adminSessionToken") ||
          sessionStorage.getItem("adminAuthenticated");
        const sessionExpiry = localStorage.getItem("sessionExpiry");

        if (!sessionToken) {
          window.location.href = "/admin-login.html";
          return false;
        }

        if (sessionExpiry) {
          const expiryTime = parseInt(sessionExpiry);
          if (isNaN(expiryTime) || Date.now() > expiryTime) {
            localStorage.removeItem("adminSession");
            localStorage.removeItem("adminRefreshToken");
            localStorage.removeItem("sessionExpiry");
            window.location.href = "/admin-login.html";
            return false;
          }
        }

        return true;
      }

      // Initialize
      if (checkAuthentication()) {
        loadEvents();
      }
    </script>
  </body>
</html>
