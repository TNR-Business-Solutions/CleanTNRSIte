class TNRCRMData{constructor(){this.clients=this.loadClients(),this.leads=this.loadLeads(),this.orders=this.loadOrders(),this.formSubmissions=this.loadFormSubmissions(),this.checkForNewSubmissions(),this.initializeNotifications()}loadClients(){return[{id:"client-001",name:"Test Construction Company",industry:"Construction",email:"test@construction.com",phone:"(412) 555-0101",address:"123 Main St, Greensburg, PA 15601",status:"Active",joinDate:"2024-01-15",lastContact:"2024-12-15",services:["Web Design","SEO Services"],notes:"Test client for construction industry",source:"Website Form"},{id:"client-002",name:"Test Law Firm",industry:"Legal Services",email:"test@lawfirm.com",phone:"(412) 555-0102",address:"456 Oak Ave, Greensburg, PA 15601",status:"Active",joinDate:"2024-02-20",lastContact:"2024-12-10",services:["Social Media Management","Content Creation"],notes:"Test client for legal services industry",source:"Referral"},{id:"client-003",name:"Test E-commerce Store",industry:"E-commerce",email:"test@estore.com",phone:"(412) 555-0103",address:"789 Pine St, Greensburg, PA 15601",status:"Active",joinDate:"2024-03-10",lastContact:"2024-12-05",services:["Paid Advertising","Email Marketing"],notes:"Test client for e-commerce industry",source:"Google Ads"},{id:"client-004",name:"Test Restaurant",industry:"Food Service",email:"test@restaurant.com",phone:"(412) 555-0104",address:"321 Market St, Greensburg, PA 15601",status:"Active",joinDate:"2024-04-05",lastContact:"2024-12-01",services:["Social Media Management","Local SEO"],notes:"Test client for restaurant industry",source:"Facebook"},{id:"client-005",name:"Test Medical Practice",industry:"Healthcare",email:"test@medical.com",phone:"(412) 555-0105",address:"654 Health Dr, Greensburg, PA 15601",status:"Active",joinDate:"2024-05-12",lastContact:"2024-11-28",services:["Web Design","Local SEO"],notes:"Test client for healthcare industry",source:"Website Form"}]}loadLeads(){return[]}loadOrders(){return[{id:"order-001",clientId:"client-001",clientName:"Test Construction Company",industry:"Construction",service:"Web Design & SEO Package",amount:2500,status:"Completed",orderDate:"2024-01-15",completionDate:"2024-02-15",description:"Complete website redesign with SEO optimization for construction company"},{id:"order-002",clientId:"client-002",clientName:"Test Law Firm",industry:"Legal Services",service:"Social Media Management",amount:1200,status:"In Progress",orderDate:"2024-02-20",completionDate:null,description:"Monthly social media management for law firm"},{id:"order-003",clientId:"client-003",clientName:"Test E-commerce Store",industry:"E-commerce",service:"Paid Advertising Campaign",amount:3e3,status:"Completed",orderDate:"2024-03-10",completionDate:"2024-04-10",description:"Google Ads and Facebook advertising campaign for online store"},{id:"order-004",clientId:"client-004",clientName:"Test Restaurant",industry:"Food Service",service:"Local SEO & Social Media",amount:1800,status:"In Progress",orderDate:"2024-04-05",completionDate:null,description:"Local SEO optimization and social media management for restaurant"},{id:"order-005",clientId:"client-005",clientName:"Test Medical Practice",industry:"Healthcare",service:"Website Design & Local SEO",amount:2200,status:"Completed",orderDate:"2024-05-12",completionDate:"2024-06-12",description:"Professional website design with local SEO for medical practice"}]}loadFormSubmissions(){const e=localStorage.getItem("tnr_form_submissions"),t=e?JSON.parse(e):[];return this.autoConvertSubmissionsToLeads(t),t}checkForNewSubmissions(){const e=localStorage.getItem("tnr_form_submissions");if(e){const t=JSON.parse(e);this.autoConvertSubmissionsToLeads(t)}}autoConvertSubmissionsToLeads(e){let t=0;return e.forEach(e=>{if(!e.convertedToLead){const s={name:e.name||"Unknown",email:e.email||"",phone:e.phone||"",company:e.company||"",website:e.website||"",industry:e.industry||"Not specified",services:Array.isArray(e.services)?e.services:[e.services||"Not specified"],budget:e.budget||"",timeline:e.timeline||"",message:e.message||"",additionalInfo:e.additionalInfo||"",contactMethod:e.contactMethod||"",source:e.source||"Website Form",status:"New",submissionDate:e.submissionDate||e.timestamp||(new Date).toLocaleString(),submissionDateTime:e.submissionDateTime||e.timestamp||(new Date).toISOString(),originalSubmissionId:e.id};this.addLead(s),t++,e.convertedToLead=!0}}),e.length>0&&localStorage.setItem("tnr_form_submissions",JSON.stringify(e)),this.saveToStorage(),t}addClient(e){const t={id:"client-"+Date.now(),...e,joinDate:(new Date).toISOString().split("T")[0],lastContact:(new Date).toISOString().split("T")[0],status:"Active"};return this.clients.push(t),this.saveToStorage(),t}updateClient(e,t){const s=this.clients.findIndex(t=>t.id===e);return-1!==s?(this.clients[s]={...this.clients[s],...t},this.saveToStorage(),this.clients[s]):null}deleteClient(e){this.clients=this.clients.filter(t=>t.id!==e),this.saveToStorage()}getClient(e){return this.clients.find(t=>t.id===e)}addLead(e){const t={id:"lead-"+Date.now(),...e,date:(new Date).toISOString().split("T")[0],status:"New"};return this.leads.push(t),this.saveToStorage(),t}convertLeadToClient(e){const t=this.leads.find(t=>t.id===e);if(t){const s=this.addClient({name:t.name,email:t.email,phone:t.phone,industry:t.industry,address:t.address||"",services:t.services||[],notes:t.notes||"",source:t.source||"Lead Conversion"});return this.leads=this.leads.filter(t=>t.id!==e),this.saveToStorage(),s}return null}addOrder(e){const t={id:"order-"+Date.now(),...e,orderDate:(new Date).toISOString().split("T")[0],status:"Pending"};return this.orders.push(t),this.saveToStorage(),t}updateOrder(e,t){const s=this.orders.findIndex(t=>t.id===e);return-1!==s?(this.orders[s]={...this.orders[s],...t},this.saveToStorage(),this.orders[s]):null}getStats(){return{totalClients:this.clients.length,activeClients:this.clients.filter(e=>"Active"===e.status).length,newLeads:this.leads.filter(e=>"New"===e.status).length,totalOrders:this.orders.length,completedOrders:this.orders.filter(e=>"Completed"===e.status).length,pendingOrders:this.orders.filter(e=>"Pending"===e.status).length,inProgressOrders:this.orders.filter(e=>"In Progress"===e.status).length,totalRevenue:this.orders.reduce((e,t)=>e+(t.amount||0),0)}}saveToStorage(){localStorage.setItem("tnr_crm_clients",JSON.stringify(this.clients)),localStorage.setItem("tnr_crm_leads",JSON.stringify(this.leads)),localStorage.setItem("tnr_crm_orders",JSON.stringify(this.orders)),localStorage.setItem("tnr_crm_form_submissions",JSON.stringify(this.formSubmissions))}loadFromStorage(){const e=localStorage.getItem("tnr_crm_clients"),t=localStorage.getItem("tnr_crm_leads"),s=localStorage.getItem("tnr_crm_orders"),i=localStorage.getItem("tnr_crm_form_submissions");e&&(this.clients=JSON.parse(e)),t&&(this.leads=JSON.parse(t)),s&&(this.orders=JSON.parse(s)),i&&(this.formSubmissions=JSON.parse(i))}initializeNotifications(){this.addNotificationCSS(),this.updateNotificationCount(),setInterval(()=>{this.updateNotificationCount()},5e3)}addNotificationCSS(){if(document.getElementById("crm-notification-css"))return;const e=document.createElement("style");e.id="crm-notification-css",e.textContent="\n      .crm-notification-bubble {\n        position: absolute;\n        top: -8px;\n        right: -8px;\n        background: #ff4444;\n        color: white;\n        border-radius: 50%;\n        width: 20px;\n        height: 20px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 12px;\n        font-weight: bold;\n        z-index: 1000;\n        animation: pulse 2s infinite;\n        box-shadow: 0 2px 4px rgba(0,0,0,0.3);\n      }\n      \n      .crm-notification-bubble.hidden {\n        display: none;\n      }\n      \n      @keyframes pulse {\n        0% { transform: scale(1); }\n        50% { transform: scale(1.1); }\n        100% { transform: scale(1); }\n      }\n      \n      .crm-button-container {\n        position: relative;\n        display: inline-block;\n      }\n    ",document.head.appendChild(e)}updateNotificationCount(){const e=this.leads.filter(e=>"New"===e.status).length;document.querySelectorAll('a[href*="admin-dashboard"], a[href*="crm"], .crm-button').forEach(t=>{if(!t.parentElement.classList.contains("crm-button-container")){const e=document.createElement("div");e.className="crm-button-container",t.parentNode.insertBefore(e,t),e.appendChild(t)}let s=t.parentElement.querySelector(".crm-notification-bubble");s||(s=document.createElement("div"),s.className="crm-notification-bubble",t.parentElement.appendChild(s)),e>0?(s.textContent=e>99?"99+":e.toString(),s.classList.remove("hidden")):s.classList.add("hidden")})}markLeadsAsViewed(){this.leads.forEach(e=>{"New"===e.status&&(e.status="Viewed")}),this.saveToStorage(),this.updateNotificationCount()}processFormSubmission(e){const t=this.addLead({name:e.name||"Unknown",email:e.email||"",phone:e.phone||"",industry:e.industry||"General",message:e.message||"",source:"Website Form",services:e.services||[]});return this.updateNotificationCount(),t}}window.TNRCRMData=TNRCRMData,window.tnrCRM=new TNRCRMData;